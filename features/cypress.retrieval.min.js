CYPRESS.CONSTS.FORGING_DATA={QUALITY:[1,1.05,1.15,1.27,1.39,1.54,1.69,1.84,1.99,2.14,2.29],GP:{"小型盾":5,"中型盾":10,"大型盾":15},WEIGHT:[[0,0,0,0,0,0,0,0,0,0,0],[0,0,0,0,0,0,0,.1,.1,.1,.1],[0,0,0,0,.1,.1,.1,.1,.2,.2,.2],[0,0,0,.1,.1,.1,.2,.2,.2,.2,.2],[0,0,.1,.1,.1,.2,.2,.3,.3,.3,.4],[0,.1,.1,.2,.2,.3,.3,.4,.4,.5,.5]],RANGE:[0,10,20,30,40,60,80,100,120,120,120],SPECIAL_QUALITY:{"弓":[0,0,0,1,2,3,4,5,7,7,7],"銃":[0,1,2,4,6,9,12,16,21,21,21]}},CYPRESS.CONSTS.STANDARD_LEVEL_FLOOR=[1,1,1,1,1,1,1,1,1,24,27,30,33,36,38,40,42,44,46,48,50],CYPRESS.EQUIPMENT_STYLE={ORDERS:{CLASSES:["FIG","THI","MAG","PRI","SAM","NIN","BIS","LOR","CLO"],PHYSICAL_ATTRIBUTES:["SLASH","STRIKE","PIERCE"],SPECIAL_EFFECTS:["HP","MP","STR","VIT","DEX","AGI","INT","PIE","LUK"],RESISTANCE:["POISON","PARALYZE","PETRIFY","FAINT","BLIND","SLEEP","SILENCE","CHARM","CONFUSION","FEAR"],ATTRIBUTES:["FIRE","WATER","WIND","EARTH","LIGHT","DARK"],FLAGS:["SELL","TRADE","STOLEN","BLESSED","CURSED","USED"]},REGEXP:{DISABLE_FORGE:/^Legend$|^Artifact$/,RANGED_WEAPONS:/^弓$|^銃$/,SHOTS:/^矢$|^銃弾$/,ACCESSORIES:/^指輪$|^耳飾り$|^首飾り$|^ベルト$/,SHIELDS:/^[大中小]型盾$/,WITHOUT_PHYSICAL_ATTRIBUTES:/^弓$|^銃$|^指輪$|^耳飾り$|^首飾り$|^ベルト$/,WITH_SPECIAL_PROPERTIES:/^弓$|^銃$|^矢$|^銃弾$|^[大中小]型盾$/}},CYPRESS.STATUS={rarity:{Poor:!1,Normal:!1,Good:!1,Master:!1,Legend:!1,Artifact:!1},"class":{FIG:!1,THI:!1,MAG:!1,PRI:!1,SAM:!1,NIN:!1,BIS:!1,LOR:!1,CLO:!1},type:{"片手剣":!1,"両手剣":!1,"片手斧":!1,"両手斧":!1,"片手鈍器":!1,"両手鈍器":!1,"槍":!1,"暗器":!1,"短剣":!1,"両手杖":!1,"刀":!1,"双刃":!1,"弓":!1,"矢":!1,"銃":!1,"銃弾":!1,"兜":!1,"帽子":!1,"頭巾":!1,"鎧":!1,"外衣":!1,"上衣":!1,"脚鎧":!1,"衣服":!1,"下衣":!1,"手甲":!1,"手袋":!1,"腕輪":!1,"鉄靴":!1,"革靴":!1,"靴":!1,"大型盾":!1,"中型盾":!1,"小型盾":!1,"外套":!1,"指輪":!1,"耳飾り":!1,"首飾り":!1,ベルト:!1},flag:{when_equipped:"all",status_change:"all",blessed:"all",cursed:"all",used:"all",sell:"all",trade:"all",stolen:"all"}},CYPRESS.SORT_CONFIG={category:"CATALOG",key:"CATALOG",order:"ASC"},CYPRESS.BuilderUtils={isWeapon:function(type){"use strict";return 0<=$.inArray(type,["暗器","短剣","片手剣","両手剣","刀","片手斧","両手斧","槍","片手鈍器","両手鈍器","両手杖","弓","矢","銃","銃弾","双刃"])}},CYPRESS.getEquipmentCard=function(equipment){"use strict";var COLUMN=CYPRESS.COLUMN,CLASSMASKS=CYPRESS.CONSTS.CLASSMASKS,STANDARD_LEVEL_FLOOR=CYPRESS.CONSTS.STANDARD_LEVEL_FLOOR,ORDERS=CYPRESS.EQUIPMENT_STYLE.ORDERS,REGEXP=CYPRESS.EQUIPMENT_STYLE.REGEXP,BuilderUtils=CYPRESS.BuilderUtils,record=equipment.equipment,type=record[COLUMN.TYPE],buildCard={card:'<button class="data-copy">&#xe604;</button>',buildTransfarTagData:function(column,content){this.card+='<span class="'+column+'">'+(record[COLUMN[column.toUpperCase()]]?"":content)+"</span>"},buildSupplimentTagData:function(column,text){record[COLUMN[column.toUpperCase()]]&&(this.card+='<span class="'+column+'"><img src="images/'+column+'.png" alt="">'+text+"</span>")},label:function(label){return this.card+='<span class="label">'+label+"：</span>",this},sectionDivider:function(){return this.card+='<div class="section-divider"></div>',this},group:function(groupName){return this.card+='<div class="'+groupName+'">',this},end:function(){return this.card+="</div>",this},unsignedInteger:function(className,column){var value=record[column];return this.card+='<span class="'+className+(0===value?" zero":" positive")+'">'+value+"</span>",this},signedInteger:function(className,column){var value=record[column],sign="zero",data=0;return 0>value?(sign="negative",data=value):value>0&&(sign="positive",data="+"+value),this.card+='<span class="'+className+" "+sign+'">'+data+"</span>",this},direct:function(className,column){return this.card+='<span class="'+className+'">'+record[column]+"</span>",this},rarity:function(){return this.direct("rarity",COLUMN.RARITY),this},type:function(){return this.direct("type",COLUMN.TYPE),this},level:function(){var STDLVF=STANDARD_LEVEL_FLOOR[record[COLUMN.GRADE]],floor=record[COLUMN.LEVEL_FLOOR],ceil=record[COLUMN.LEVEL_CEIL],floorText="Lv "+floor,ceilText=-1===ceil?"":"Lv "+ceil,sign="normal";return-1!==ceil||floor>STDLVF?sign="negative":STDLVF>floor&&(sign="positive"),this.card+='<span class="level '+sign+'">'+floorText+"～"+ceilText+"</span>",this},grade:function(){var grade=record[COLUMN.GRADE];return this.card+=grade?'<span class="grade">'+grade+"</span>":"",this},name:function(){return this.direct("name",COLUMN.NAME),this},restriction:function(){return this.direct("restriction",COLUMN.RESTRICTION),this},powers:function(){var offenseOrDefense=BuilderUtils.isWeapon(type)?"weapons":"guards";return this.card+='<span class="physical '+offenseOrDefense+'">'+record[COLUMN.PHYSICAL]+'</span><span class="magical '+offenseOrDefense+'">'+record[COLUMN.MAGICAL]+"</span>",this},whenEquipped:function(){return this.card+=""===record[COLUMN.WHEN_EQUIPPED]?'<span class="when-equipped zero"></span>':'<span class="when-equipped '+(record[COLUMN.WEPN]?"positive":"negative")+'">'+record[COLUMN.WHEN_EQUIPPED]+"</span>",this},statusChange:function(){return this.card+=0<record[COLUMN.PERCENT]?'<span class="status-change '+(record[COLUMN.SCPN]?"positive":"negative")+'">'+record[COLUMN.STATUS_CHANGE]+" ("+record[COLUMN.PERCENT]+"%)</span>":'<span class="status-change zero"></span>',this},classRestriction:function(){var cr=record[COLUMN.CLASS],buildClassIcon=function(cls){return'<span class="'+cls.toLowerCase()+" "+(cr&CLASSMASKS[cls]?"equipable":"non-equipable")+'">'+cls+"</span>"},that=this;return this.group("class-restriction"),$.each(ORDERS.CLASSES,function(){that.card+=buildClassIcon(this)}),this.end(),this},transfarTags:function(){return this.buildTransfarTagData("sell","[売却不可]"),this.buildTransfarTagData("trade","[トレード不可]"),this.buildSupplimentTagData("used","使用後トレード不可"),this.buildTransfarTagData("stolen",'<img src="images/stolen.png" alt="略奪されない">略奪されない'),this},supplimentTags:function(){return this.buildSupplimentTagData("blessed","祝福されている"),this.buildSupplimentTagData("cursed","呪われている"),this},physicalAttributes:function(){var that=this;return REGEXP.WITHOUT_PHYSICAL_ATTRIBUTES.test(type)||(this.group("physical-attributes"),this.label("物理属性"),$.each(ORDERS.PHYSICAL_ATTRIBUTES,function(){that.card+='<span class="'+this.toLowerCase()+'">'+record[COLUMN[this]]+"</span>"}),this.end()),this},properties:function(){return this.card+=REGEXP.ACCESSORIES.test(type)?'<span class="weight">'+record[COLUMN.WEIGHT].toFixed(2)+"</span>":REGEXP.SHOTS.test(type)?'<span class="weight">'+record[COLUMN.WEIGHT].toFixed(2)+'</span><span class="hardness">'+record[COLUMN.HARDNESS]+"</span>":'<span class="durability">'+record[COLUMN.DURABILITY]+'</span><span class="weight">'+record[COLUMN.WEIGHT].toFixed(2)+'</span><span class="hardness">'+record[COLUMN.HARDNESS]+"</span>",this},specialPropertiesLine:function(){var content={"弓":function(){return'<span class="range">'+record[COLUMN.RANGE]+'</span><span class="quality bows">'+record[COLUMN.QUALITY]+"</span>"},"矢":function(){var range=record[COLUMN.RANGE],quality=record[COLUMN.QUALITY];return'<span class="range-rate'+(100!==range?100>range?" negative":" positive":"")+'">'+range+'%</span><span class="quality-rate bows'+(100!==quality?100>quality?" negative":" positive":"")+'">'+quality+"%</span>"},"銃":function(){return'<span class="range">'+record[COLUMN.RANGE]+'</span><span class="quality guns">'+record[COLUMN.QUALITY]+'</span><span class="charge-weight">'+record[COLUMN.CHARGE_WEIGHT]+"</span>"},"銃弾":function(){var range=record[COLUMN.RANGE],quality=record[COLUMN.QUALITY];return'<span class="range-rate'+(100!==range?100>range?" negative":" positive":"")+'">'+range+'%</span><span class="quality-rate guns'+(100!==quality?100>quality?" negative":" positive":"")+'">'+quality+"%</span>"},"小型盾":function(){var gp=record[COLUMN.QUALITY];return gp?'<span class="quality gp">'+gp+"</span>":""},"中型盾":function(){return'<span class="quality gp">'+record[COLUMN.QUALITY]+"</span>"},"大型盾":function(){return'<span class="quality gp">'+record[COLUMN.QUALITY]+"</span>"}};return REGEXP.WITH_SPECIAL_PROPERTIES.test(type)&&(this.group("special-properties"),this.card+=content[type](),this.end()),this},specialEffectsLine:function(){var specialEffects=function(){var obj={};return $.each(ORDERS.SPECIAL_EFFECTS,function(){obj[this]=record[COLUMN[this]]}),obj}(),isAllZero=function(){for(var se in specialEffects)if(0!==specialEffects[se])return!1;return!0}(),that=this;return isAllZero||(this.group("special-effects"),this.label("特殊効果"),$.each(ORDERS.SPECIAL_EFFECTS,function(){that.signedInteger(this.toLowerCase(),COLUMN[this])}),this.end()),this},resistanceLine:function(){var resistance=function(){var obj={};return $.each(ORDERS.RESISTANCE,function(){obj[this]=record[COLUMN[this]]}),obj}(),isAllZero=function(){for(var rst in resistance)if(0!==resistance[rst])return!1;return!0}(),that=this;return isAllZero||(this.group("resistance"),this.label("状態異常耐性"),$.each(ORDERS.RESISTANCE,function(){that.unsignedInteger(this.toLowerCase(),COLUMN[this])}),this.end()),this},magicAttributesLine:function(){var label={ATTACK:"魔攻属性",RESIST:"魔防属性"},that=this,attributes=function(){var setAttributes=function(type){var obj={};return $.each(ORDERS.ATTRIBUTES,function(){obj[this]=record[COLUMN[this+"_"+type]]}),obj};return{ATTACK:setAttributes("ATTACK"),RESIST:setAttributes("RESIST")}}(),isAllZero=function(){var checkAllZero=function(type){for(var atr in attributes[type])if(0!==attributes[type][atr])return!1;return!0};return{ATTACK:checkAllZero("ATTACK"),RESIST:checkAllZero("RESIST")}}(),build=function(type){that.group(type),that.label(label[type]),isAllZero[type]?that.card+='<span class="allZero">補正なし</span>':$.each(attributes[type],function(atr){that.signedInteger(atr.toLowerCase(),COLUMN[atr+"_"+type])}),that.end()};return isAllZero.ATTACK&&isAllZero.RESIST||(this.group("magic-attributes"),build("ATTACK"),build("RESIST"),this.end()),this},otherDataLine:function(){var whenEquipped=record[COLUMN.WHEN_EQUIPPED],statusChange=record[COLUMN.STATUS_CHANGE];return(""!==whenEquipped||""!==statusChange)&&(this.group("other-data"),this.card+=""===whenEquipped?'<span class="when-equipped zero"></span>':'<span class="when-equipped '+(record[COLUMN.WEPN]?"positive":"negative")+'">'+record[COLUMN.WHEN_EQUIPPED]+"</span>",this.card+=""===statusChange?'<span class="status-change zero"></span>':'<span class="status-change '+(0<record[COLUMN.PERCENT]?"positive":"negative")+'">'+record[COLUMN.STATUS_CHANGE]+" ("+Math.abs(record[COLUMN.PERCENT])+"%)</span>",this.end()),this},notesLine:function(){var LABEL=0,TEXT=1,lines={comments:["コメント",record[COLUMN.COMMENTS]],sources:["入手経路",record[COLUMN.SOURCES]],notes:["ノート",record[COLUMN.NOTES]]},that=this;return lines.comments[TEXT]+lines.sources[TEXT]+lines.notes[TEXT]!==""&&(this.group("notes-line"),this.sectionDivider(),$.each(["comments","sources","notes"],function(){""!==lines[this][TEXT]&&(that.card+='<div class="'+this+'"><span class="'+this+'-label">'+lines[this][LABEL]+'：</span><span class="'+this+'-text">'+lines[this][TEXT]+"</span></div>")}),this.end()),this},toolbox:function(){var forge=equipment.forge,ableForge=function(){return REGEXP.DISABLE_FORGE.test(record[COLUMN.RARITY])?" disabled":REGEXP.SHOTS.test(type)?" disabled":""}();return this.card+=0===forge?'<div class="toolbox"><div class="tool-buttons"><span class="tool-button forging-plus'+ableForge+'">+1</span><span class="tool-button forging-minus disabled">-1</span></div></div>':10===forge?'<div class="toolbox"><div class="tool-buttons"><span class="tool-button forging-plus disabled">+1</span><span class="tool-button forging-minus">-1</span></div></div>':'<div class="toolbox"><div class="tool-buttons"><span class="tool-button forging-plus">+1</span><span class="tool-button forging-minus">-1</span></div></div>',this}};return buildCard.group("equipment-card-inner "+record[COLUMN.RARITY].toLowerCase()).group("basic-information").group("property").rarity().type().transfarTags().end().group("restrictions").level().grade().restriction().end().group("name-box").name().supplimentTags().end().end().sectionDivider().classRestriction().group("capabilities").powers().properties().physicalAttributes().end().specialPropertiesLine().specialEffectsLine().resistanceLine().magicAttributesLine().otherDataLine().notesLine().end().toolbox(),buildCard.card},CYPRESS.getEquipmentString=function(equipment){"use strict";var COLUMN=CYPRESS.COLUMN,CLASSMASKS=CYPRESS.CONSTS.CLASSMASKS,ORDERS=CYPRESS.EQUIPMENT_STYLE.ORDERS,REGEXP=CYPRESS.EQUIPMENT_STYLE.REGEXP,BuilderUtils=CYPRESS.BuilderUtils,buildString={string:"",basic:function(){return this.string+=equipment[COLUMN.NAME]+" グレード"+equipment[COLUMN.GRADE]+" "+equipment[COLUMN.RARITY]+" "+equipment[COLUMN.TYPE]+" / ",this},property:function(){var type=equipment[COLUMN.TYPE],offenseOrDefense=BuilderUtils.isWeapon(type)?"攻撃力":"防御力";switch(this.string+="物理"+offenseOrDefense+"："+equipment[COLUMN.PHYSICAL]+" 魔法"+offenseOrDefense+"："+equipment[COLUMN.MAGICAL]+" ",type){case"弓":this.string+="射程距離："+equipment[COLUMN.RANGE]+" 溜め性能："+equipment[COLUMN.QUALITY]+" ";break;case"弓矢":this.string+="射程効率："+equipment[COLUMN.RANGE]+"% 溜め効率："+equipment[COLUMN.QUALITY]+"% ";break;case"銃":this.string+="射程距離："+equipment[COLUMN.RANGE]+" 装填性能："+equipment[COLUMN.QUALITY]+" 装填数："+equipment[COLUMN.CHARGE_WEIGHT]+" ";break;case"銃弾":this.string+="射程効率："+equipment[COLUMN.RANGE]+"% 装填効率："+equipment[COLUMN.QUALITY]+"% ";break;case"小型盾":case"中型盾":case"大型盾":this.string+="GP："+equipment[COLUMN.QUALITY]+" "}return this.string+=REGEXP.ACCESSORIES.test(type)?"重量："+equipment[COLUMN.WEIGHT].toFixed(2):REGEXP.SHOTS.test(type)?"重量："+equipment[COLUMN.WEIGHT].toFixed(2)+" 硬度："+equipment[COLUMN.HARDNESS]+" ":"耐久度："+equipment[COLUMN.DURABILITY]+" 重量："+equipment[COLUMN.WEIGHT].toFixed(2)+" 硬度："+equipment[COLUMN.HARDNESS]+" ",REGEXP.WITHOUT_PHYSICAL_ATTRIBUTES.test(type)||(this.string+="物理属性：[ 斬"+equipment[COLUMN.SLASH]+" 打"+equipment[COLUMN.STRIKE]+" 突"+equipment[COLUMN.PIERCE]+" ]"),this},speciaEffects:function(){var data=function(){var data=[];return $.each(ORDERS.SPECIAL_EFFECTS,function(){var offset=equipment[COLUMN[this]];0!==offset&&data.push(this+(offset>0?"+"+offset:offset))}),data}(),that=this;return 0<data.length&&(this.string+=" ステータス補正：",$.each(data,function(){that.string+=this+" "}),this.string=this.string.slice(0,-1)),this},magicAttributesOffsets:function(){var ATTRIBUTES_J={FIRE:"火",WATER:"水",WIND:"風",EARTH:"地",LIGHT:"光",DARK:"闇"},resist=function(){var data=[];return $.each(ORDERS.ATTRIBUTES,function(){var offset=equipment[COLUMN[this+"_RESIST"]];0!==offset&&data.push(ATTRIBUTES_J[this]+(offset>0?"+"+offset:offset))}),data}(),attack=function(){var data=[];return $.each(ORDERS.ATTRIBUTES,function(){var offset=equipment[COLUMN[this+"_ATTACK"]];0!==offset&&data.push(ATTRIBUTES_J[this]+(offset>0?"+"+offset:offset))}),data}(),that=this;return 0<resist.length&&(this.string+=" 魔法防御属性：",$.each(resist,function(){that.string+=this+" "}),this.string=this.string.slice(0,-1)),0<attack.length&&(this.string+=" 魔法攻撃属性：",$.each(attack,function(){that.string+=this+" "}),this.string=this.string.slice(0,-1)),this},resistances:function(){var data=function(){var data=[],RESISTANCE_J={POISON:"毒",PARALYZE:"麻痺",PETRIFY:"石化",FAINT:"気絶",BLIND:"暗闇",SLEEP:"睡眠",SILENCE:"沈黙",CHARM:"魅了",CONFUSION:"混乱",FEAR:"恐怖"};return $.each(ORDERS.RESISTANCE,function(){var offset=equipment[COLUMN[this]];0!==offset&&data.push(RESISTANCE_J[this]+offset)}),data}(),that=this;return 0<data.length&&(this.string+=" 状態異常耐性：",$.each(data,function(){that.string+=this+" "}),this.string=this.string.slice(0,-1)),this},otherEffect:function(){var whenEquipped=equipment[COLUMN.WHEN_EQUIPPED],statusChange=equipment[COLUMN.STATUS_CHANGE];return""!==whenEquipped&&(this.string+=" 装備時に "+whenEquipped),""!==statusChange&&(this.string+=" 状態異常："+statusChange+"("+equipment[COLUMN.PERCENT]+"%)"),this},restrictions:function(){var levelText=function(){var ceil=equipment[COLUMN.LEVEL_CEIL];return"Lv"+equipment[COLUMN.LEVEL_FLOOR]+"～"+(-1===ceil?"":"Lv "+ceil)}(),classRestriction=function(){var ALL_CLASS=511,cr=equipment[COLUMN.CLASS],classRestrictionText="";return cr===ALL_CLASS?"全職業 ":($.each(ORDERS.CLASSES,function(){classRestrictionText+=cr&CLASSMASKS[this]?this+" ":""}),classRestrictionText)}(),restriction=equipment[COLUMN.RESTRICTION];return this.string+=" / 装備条件："+classRestriction+levelText,""!==restriction&&(this.string+=" "+restriction),this},flags:function(){var flagsText=function(){var text="";return text+=equipment[COLUMN.SELL]?"":"売却不可 ",text+=equipment[COLUMN.TRADE]?"":"トレード不可 ",text+=equipment[COLUMN.STOLEN]?"":"略奪されない ",text+=equipment[COLUMN.BLESSED]?"祝福されている ":"",text+=equipment[COLUMN.CURSED]?"呪われている ":"",text+=equipment[COLUMN.USED]?"使用後トレード不可 ":""}();return""!==flagsText&&(flagsText=flagsText.slice(0,-1),this.string+=" / "+flagsText),this}};return buildString.basic().property().speciaEffects().magicAttributesOffsets().resistances().otherEffect().restrictions().flags(),buildString.string},CYPRESS.displayEquipmentCard=function(equipments){"use strict";$("#equipments").empty(),$("#usage-button").prop("disabled",!1),$.each(equipments,function(){$("#equipments").append('<div class="equipment-card" data-catalog="'+this.catalog+'">'+CYPRESS.getEquipmentCard(this)+"</div>")})},CYPRESS.makeRequest=function(){"use strict";var COLUMN=CYPRESS.COLUMN,_matchWord=function(){var word=$("#equipment-name").val();return""===word?function(){return!0}:function(record){return null!==record[COLUMN.NAME].match(word)}}(),_containsGradeRange=function(){var range=$("#grade-range").prop("value").split(";"),floor=parseInt(range[0],10),ceil=parseInt(range[1],10);return 1===floor?ceil===CYPRESS.CONSTS.CAPS.GRADE?function(){return!0}:function(record){return record[COLUMN.GRADE]<=ceil}:ceil===CYPRESS.CONSTS.CAPS.GRADE?function(record){return floor<=record[COLUMN.GRADE]}:function(record){var grade=record[COLUMN.GRADE];return grade>=floor&&ceil>=grade}}(),_containsLevelRange=function(){var range=$("#level-range").prop("value").split(";"),floor=parseInt(range[0],10),ceil=parseInt(range[1],10);return 1===floor?ceil===CYPRESS.CONSTS.CAPS.LEVEL?function(){return!0}:function(record){return record[COLUMN.LEVEL_FLOOR]<=ceil}:ceil===CYPRESS.CONSTS.CAPS.LEVEL?function(record){var equipmentCeil=record[COLUMN.LEVEL_CEIL];return floor<=(-1===equipmentCeil?CYPRESS.CONSTS.CAPS.LEVEL:equipmentCeil)}:function(record){var equipmentCeil=record[COLUMN.LEVEL_CEIL];return floor<=(-1===equipmentCeil?CYPRESS.CONSTS.CAPS.LEVEL:equipmentCeil)&&record[COLUMN.LEVEL_FLOOR]<=ceil}}(),_containsClasses=function(){var classMask=CYPRESS.CONSTS.CLASSMASKS,requireMask=function(){var mask=0;return $.each(CYPRESS.STATUS["class"],function(key,value){mask+=value?classMask[key]:0}),mask}();return 0===requireMask||511===requireMask?function(){return!0}:function(record){return requireMask&record[COLUMN.CLASS]}}(),_containsSelection=function(column){var selection=0;return $.each(CYPRESS.STATUS[column],function(){selection+=this?1:0}),selection?function(record){return CYPRESS.STATUS[column][record[COLUMN[column.toUpperCase()]]]}:function(){return!0}},_filterStringFlag=function(flag){switch(CYPRESS.STATUS.flag[flag]){case"only":return function(record){return""!==record[COLUMN[flag.toUpperCase()]]};case"eliminate":return function(record){return""===record[COLUMN[flag.toUpperCase()]]};default:return function(){return!0}}},_filterBooleanFlag=function(flag,inv){switch(CYPRESS.STATUS.flag[flag]){case"only":return function(record){return inv?!record[COLUMN[flag.toUpperCase()]]:record[COLUMN[flag.toUpperCase()]]};case"eliminate":return function(record){return inv?record[COLUMN[flag.toUpperCase()]]:!record[COLUMN[flag.toUpperCase()]]};default:return function(){return!0}}},_containsRarities=_containsSelection("rarity"),_containsTypes=_containsSelection("type"),_filterWhenEquipped=_filterStringFlag("when_equipped"),_filterStatusChange=_filterStringFlag("status_change"),_filterBlessed=_filterBooleanFlag("blessed",!1),_filterCursed=_filterBooleanFlag("cursed",!1),_filterUsed=_filterBooleanFlag("used",!1),_filterSell=_filterBooleanFlag("sell",!0),_filterTrade=_filterBooleanFlag("trade",!0),_filterStolen=_filterBooleanFlag("stolen",!0),_request=function(record){return _matchWord(record)&&_containsGradeRange(record)&&_containsLevelRange(record)&&_containsClasses(record)&&_containsRarities(record)&&_containsTypes(record)&&_filterWhenEquipped(record)&&_filterStatusChange(record)&&_filterBlessed(record)&&_filterCursed(record)&&_filterUsed(record)&&_filterSell(record)&&_filterTrade(record)&&_filterStolen(record)};return _request},CYPRESS.makeCompareFunction=function(){"use strict";var _compare,COLUMN=CYPRESS.COLUMN,CONFIG=CYPRESS.SORT_CONFIG,order="ASC"===CONFIG.order?1:-1,RARITY_CODE={Poor:1,Normal:2,Good:3,Master:4,Legend:5,Artifact:6};switch(CONFIG.category){case"LAXICOGRAPHIC":_compare=function(a,b){return(a.equipment[COLUMN[CONFIG.key]]>b.equipment[COLUMN[CONFIG.key]]?1:a.equipment[COLUMN[CONFIG.key]]<b.equipment[COLUMN[CONFIG.key]]?-1:0)*order};break;case"NUMERIC":_compare="RARITY"===CONFIG.key?function(a,b){return(RARITY_CODE[a.equipment[COLUMN.RARITY]]-RARITY_CODE[b.equipment[COLUMN.RARITY]])*order}:function(a,b){return(a.equipment[COLUMN[CONFIG.key]]-b.equipment[COLUMN[CONFIG.key]])*order};break;default:_compare=function(a,b){return a.catalog-b.catalog}}return _compare},CYPRESS.Forging=function(equipment){"use strict";var COLUMN=CYPRESS.COLUMN,FORGING_DATA=CYPRESS.CONSTS.FORGING_DATA,REGEXP=CYPRESS.EQUIPMENT_STYLE.REGEXP,BASE=CYPRESS.EQUIPMENT[equipment.catalog],TYPE=BASE[COLUMN.TYPE],WEIGHT=BASE[COLUMN.WEIGHT],FORGE=equipment.forge,RECORD=equipment.equipment,WEIGHT_CLASSS=function(){return.2>WEIGHT?0:.4>WEIGHT?1:1>WEIGHT?2:2>WEIGHT?3:4>WEIGHT?4:5}();RECORD[COLUMN.NAME]=BASE[COLUMN.NAME]+(FORGE>0?"+"+FORGE:""),RECORD[COLUMN.PHYSICAL]=Math.floor(BASE[COLUMN.PHYSICAL]*FORGING_DATA.QUALITY[FORGE]),RECORD[COLUMN.MAGICAL]=Math.floor(BASE[COLUMN.MAGICAL]*FORGING_DATA.QUALITY[FORGE]),RECORD[COLUMN.WEIGHT]=WEIGHT-FORGING_DATA.WEIGHT[WEIGHT_CLASSS][FORGE],REGEXP.ACCESSORIES.test(TYPE)||(RECORD[COLUMN.DURABILITY]=Math.floor(BASE[COLUMN.DURABILITY]*(1+FORGE/10)),RECORD[COLUMN.HARDNESS]=BASE[COLUMN.HARDNESS]+Math.floor(FORGE/5)),REGEXP.SHIELDS.test(TYPE)?RECORD[COLUMN.QUALITY]=BASE[COLUMN.QUALITY]+FORGE*FORGING_DATA.GP[TYPE]:REGEXP.RANGED_WEAPONS.test(TYPE)&&(RECORD[COLUMN.RANGE]=BASE[COLUMN.RANGE]+FORGING_DATA.RANGE[FORGE],RECORD[COLUMN.QUALITY]=BASE[COLUMN.QUALITY]+FORGING_DATA.SPECIAL_QUALITY[TYPE][FORGE])},CYPRESS.Manager=function(){"use strict";var _equipments=[],_writeRecords=function(records){$("#records").html(function(){switch(records){case 0:return $("#search-button-main, #search-button-sub").prop("disabled",!0),'<span class="no-records">no records</span>';case CYPRESS.CONSTS.ALL_RECORDS:return $("#search-button-main, #search-button-sub").prop("disabled",!1),'<span class="all-records">'+CYPRESS.CONSTS.ALL_RECORDS+" (all) records</span>";default:return $("#search-button-main, #search-button-sub").prop("disabled",!1),"<span>"+records+" records</span>"}}())},_display=function(){_equipments.sort(CYPRESS.makeCompareFunction()),CYPRESS.displayEquipmentCard(_equipments)},_forging=function($pushButton,forging){if(!$pushButton.hasClass("disabled")){var $card=$pushButton.parents("[data-catalog]"),catalog=$card.data("catalog"),equipment=_getCurrentEquipment(catalog);equipment.forge+=forging,CYPRESS.Forging(equipment),$card.html(CYPRESS.getEquipmentCard(equipment)),0===equipment.forge?($card.find(".forging-plus").removeClass("disabled"),$card.find(".forging-minus").addClass("disabled")):10===equipment.forge?($card.find(".forging-plus").addClass("disabled"),$card.find(".forging-minus").removeClass("disabled")):($card.find(".forging-plus").removeClass("disabled"),$card.find(".forging-minus").removeClass("disabled"))}},_getCurrentEquipment=function(catalog){var last=_equipments.length,index=0;do if(parseInt(_equipments[index].catalog,10)===catalog)return _equipments[index];while((index+=1)!==last);return null},_getEquipmentName=function(){return _equipments[Math.floor(Math.random()*_equipments.length)].equipment[CYPRESS.COLUMN.NAME]},_search=function(){_equipments=CYPRESS.search(CYPRESS.makeRequest()),_writeRecords(_equipments.length)},_setStatus=function(category,key,value){CYPRESS.STATUS[category][key]=value};return{display:_display,forging:_forging,getCurrentEquipment:_getCurrentEquipment,getEquipmentName:_getEquipmentName,search:_search,setStatus:_setStatus}}(),$(document).ready(function(){"use strict";var mySlidebars=new $.slidebars;!function(){!function(){mySlidebars.slidebars.open("right")}(),function(){$("#grade-range").ionRangeSlider({type:"double",min:1,max:CYPRESS.CONSTS.CAPS.GRADE,hide_min_max:!0,values_separator:"-",onFinish:CYPRESS.Manager.search}),$("#level-range").ionRangeSlider({type:"double",min:1,max:CYPRESS.CONSTS.CAPS.LEVEL,hide_min_max:!0,values_separator:"-",onFinish:CYPRESS.Manager.search})}(),function(){$("#choice-types").colorbox({inline:!0,href:"#dialog-types",closeButton:!1,transition:"none",onClosed:function(){CYPRESS.Manager.search()}}),$("#choice-flags").colorbox({inline:!0,href:"#dialog-flags",closeButton:!1,transition:"none",onClosed:function(){CYPRESS.Manager.search()}})}(),function(){var iCheckInitialize=function(){var $self=$(this),label=$self.data("label");$self.iCheck({checkboxClass:"icheckbox",radioClass:"icheckbox",insert:'<div class="icheck-icon"></div>'+label})};!function(){var iCheckInitializeRarities=function(){var $self=$(this),label=$self.data("label");$self.iCheck({checkboxClass:"icheckbox "+label.toLowerCase(),insert:'<div class="icheck-icon"></div>'+label})},statusChange=function(category){return function(){var $self=$(this),label=$self.data("label");CYPRESS.Manager.setStatus(category,label,$self.prop("checked")),CYPRESS.Manager.search()}};$("#query-rarities input").each(iCheckInitializeRarities).on("ifChanged",statusChange("rarity")),$("#query-classes input").each(iCheckInitialize).on("ifChanged",statusChange("class")),$("#dialog-types .control-box input").each(iCheckInitialize),$("#wrap-weapons input, #wrap-protective-gear input, #wrap-accessories input").on("ifChanged",function(){var $self=$(this),label=$self.data("label");CYPRESS.Manager.setStatus("type",label,$self.prop("checked"))}),$("#dialog-flags .control-box input").each(iCheckInitialize)}(),function(){var changeConfig=function(category,key,order){var config=CYPRESS.SORT_CONFIG;config.category=category,config.key=key,config.order=order},runSort=function(){$("#usage").length||CYPRESS.Manager.display()},checkedBehavior=function(category){return function(){changeConfig($(this).data("category"),$("#"+category+"-sort-list :checked").data("key"),$("#"+category+"-sort-order-change").data("order")),$("#"+category+"-sort-list").slideDown(),$("#"+category+"-sort-order-change").prop("disabled",!1)}},uncheckedBehavior=function(category){return function(){$("#"+category+"-sort-list").slideUp(),$("#"+category+"-sort-order-change").prop("disabled",!0)}};$("#sorting-pane [name=sort-category]").each(iCheckInitialize),$("#lexicographic-sort-list input, #numeric-sort-list input").each(iCheckInitialize).on("ifClicked",function(){$(this).prop("checked")&&runSort()}).on("ifChecked",function(){CYPRESS.SORT_CONFIG.key=$(this).data("key"),runSort()}),$("#catalog-order").on("ifChecked",function(){changeConfig("CATALOG","CATALOG","ASC"),runSort()}),$("#lexicographic-order").on("ifChecked",checkedBehavior("lexicographic")).on("ifUnchecked",uncheckedBehavior("lexicographic")),$("#numeric-order").on("ifChecked",checkedBehavior("numeric")).on("ifUnchecked",uncheckedBehavior("numeric"))}()}()}(),function(){!function(){var m2s=function(category,simples){return function(){var state=$("#query-"+category).prop("checked")?"check":"uncheck";$(simples).each(function(){$(this).iCheck(state)})}},s2m=function(category,wrap){return function(){var inputElements=$(wrap).length,checkedElements=$(wrap+":checked").length;checkedElements===inputElements?$("#query-"+category).iCheck("check"):0===checkedElements?$("#query-"+category).iCheck("uncheck").iCheck("determinate"):$("#query-"+category).iCheck("indeterminate")}},addHover=function(simples){return function(){$(simples).each(function(){$(this).parent().addClass("hover")})}},removeHover=function(simples){return function(){$(simples).each(function(){$(this).parent().removeClass("hover")})}};$.each(["weapons","protective-gear","accessories"],function(key,category){var simples="#wrap-"+category+" input";$("#query-"+category).on("ifToggled",m2s(category,simples)).on("ifDeterminate",m2s(category,simples)).next().next().mouseover(addHover(simples)).mouseout(removeHover(simples)),$(simples).on("ifToggled",s2m(category,simples))}),$.each(["head","torso","legs","arms","feet","shields"],function(key,category){var simples="#wrap-protective-gear ."+category;$("#query-"+category).on("ifToggled",m2s(category,simples)).next().next().mouseover(addHover(simples)).mouseout(removeHover(simples)),$(simples).on("ifToggled",s2m(category,simples))}),$("#dialog-types-reset").bind("click",function(){$.each(["weapons","protective-gear","accessories"],function(key,category){$("#query-"+category).iCheck("uncheck").iCheck("determinate")})}),$("#dialog-types-close").bind("click",function(){$.colorbox.close()})}(),function(){$.each(["all","only","eliminate"],function(key,choice){$("#dialog-flags ."+choice).on("ifChecked",function(){CYPRESS.Manager.setStatus("flag",$(this).data("flag"),choice)})}),$("#dialog-flags-reset").bind("click",function(){$("#dialog-flags .all").iCheck("check")}),$("#dialog-flags-close").bind("click",function(){$.colorbox.close()})}(),function(){var $usage=$("#usage");$usage.remove(),$("#usage-button").bind("click",function(){$("#equipments").prepend($usage),$("#usage-button").prop("disabled",!0)}),$("#logo").bind("click",function(){$("body").animate({scrollTop:0},"slow","swing")}),$("#equipment-name").bind("change",CYPRESS.Manager.search),$("#retrieval-button-main, #retrieval-button-sub").bind("click",function(){CYPRESS.Manager.display(),mySlidebars.slidebars.close(),$("#toolbox-button").removeClass("close")}),$("#reqiest-reset-button").click(function(){$("#equipment-name").val(""),$("#grade-range").data("ionRangeSlider").reset(),$("#level-range").data("ionRangeSlider").reset(),$("#query-rarities input").each(function(){$(this).iCheck("uncheck")}),$("#query-classes input").each(function(){$(this).iCheck("uncheck")}),$("#dialog-types-reset").click(),$("#dialog-flags-reset").click(),CYPRESS.Manager.search()}),function(){var changeOrder=function(text){return function(){var $this=$(this),order="ASC"===$this.data("order")?"DESC":"ASC";$(this).html(text[order]),$this.data("order",order),CYPRESS.SORT_CONFIG.order=order,$("#usage").length||CYPRESS.Manager.display()}};$("#lexicographic-sort-order-change").bind("click",changeOrder({ASC:'<span class="icon">&#xe603;</span> 辞書順　',DESC:'<span class="icon">&#xe602;</span> 逆辞書順'})),$("#numeric-sort-order-change").bind("click",changeOrder({ASC:'<span class="icon">&#xe601;</span> 低 → 高',DESC:'<span class="icon">&#xe600;</span> 高 → 低'}))}()}(),function(){$.event.special.copy.options.hoverClass="data-copy-hover",$.event.special.copy.options.activeClass="data-copy-active",$("#equipments").on({click:function(){CYPRESS.Manager.forging($(this),1)}},".forging-plus"),$("#equipments").on({click:function(){CYPRESS.Manager.forging($(this),-1)}},".forging-minus"),$("#equipments").on({copy:function(e){e.clipboardData.clearData(),e.clipboardData.setData("text/plain",CYPRESS.getEquipmentString(CYPRESS.Manager.getCurrentEquipment($(this).parents("[data-catalog]").data("catalog")).equipment)),e.preventDefault(),$("#tool-commentary").text("コピーしました (*ゝω･*)")},mouseenter:function(){var name=$(this).parents("[data-catalog]").find(".name").text();$("#tool-commentary").text(name+" のデータをコピー"),$(this).parents("[data-catalog]").find(".toolbox").css("visibility","visible")},mouseleave:function(){$("#tool-commentary").text(""),$(this).parents("[data-catalog]").find(".toolbox").css("visibility","")}},".data-copy")
}()}(),$("#reqiest-reset-button").click(),$("#usage-button").click(),$("#equipment-name").prop("placeholder","例："+CYPRESS.Manager.getEquipmentName())});